<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure Chat App</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    #chat { display: none; }
    #messages { border: 1px solid #ccc; height: 200px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

<div id="login">
  <input type="text" id="username" placeholder="Enter username" />
  <button id="joinBtn">Join Chat</button>
</div>

<div id="chat">
  <h3>Online Users</h3>
  <ul id="users"></ul>

  <div id="messages"></div>

  <input type="text" id="messageInput" placeholder="Type message" />
  <button id="sendBtn">Send</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  // Replace YOUR_RENDER_URL with your Render app URL
  const socket = io("https://secure-chat-h7fu.onrender.com"); 

  const loginDiv = document.getElementById('login');
  const chatDiv = document.getElementById('chat');
  const usernameInput = document.getElementById('username');
  const joinBtn = document.getElementById('joinBtn');
  const usersList = document.getElementById('users');
  const messagesDiv = document.getElementById('messages');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');

  let username = '';

  joinBtn.addEventListener('click', () => {
    username = usernameInput.value.trim();
    if (!username) return;
    socket.emit('register', username);
    loginDiv.style.display = 'none';
    chatDiv.style.display = 'block';
  });

  sendBtn.addEventListener('click', () => {
    const text = messageInput.value.trim();
    if (!text) return;
    socket.emit('sendMessage', { user: username, text });
    messageInput.value = '';
  });

  socket.on('onlineUsers', (users) => {
    usersList.innerHTML = '';
    users.forEach(u => {
      const li = document.createElement('li');
      li.textContent = u;
      usersList.appendChild(li);
    });
  });

  socket.on('receiveMessage', (msg) => {
    const div = document.createElement('div');
    div.innerHTML = `<b>${msg.user}:</b> ${msg.text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
</script>

</body>
</html>
